<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAV Data Merger</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-semibold" href="#"><i class="bi bi-diagram-2 me-2"></i>VAV Data Merger</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <div class="ms-auto d-flex align-items-center gap-2">
                    <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#instructionsModal">
                        <i class="bi bi-question-circle me-1"></i>Instructions
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <!-- File Upload Section -->
        <div class="row mb-4 g-3 align-items-stretch equalize-cards">
            <!-- TW2 File Upload -->
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Original TW2 File</h5>
                    </div>
                    <div class="card-body">
                        <div id="tw2-dropzone" class="dropzone">
                            <p class="text-center mb-0">
                                <i class="bi bi-cloud-upload" style="font-size: 2rem;"></i><br>
                                Drag & Drop your .tw2 file here<br>
                                <small>or click to browse</small>
                            </p>
                            <input type="file" id="tw2-file-input" accept=".tw2,.mdb" style="display: none;">
                        </div>
                        <div id="tw2-file-info" class="mt-3" style="display: none;">
                            <p class="mb-1"><strong>File:</strong> <span id="tw2-filename"></span></p>
                            <p class="mb-1"><strong>Records:</strong> <span id="tw2-records"></span></p>
                            <div id="tw2-columns" class="mb-2"></div>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewTW2Data()">View Sample Data</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Excel File Upload -->
            <div class="col-lg-4 col-md-6 mb-3">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Excel File</h5>
                    </div>
                    <div class="card-body">
                        <div id="excel-dropzone" class="dropzone">
                            <p class="text-center mb-0">
                                <i class="bi bi-cloud-upload" style="font-size: 2rem;"></i><br>
                                Drag & Drop your Excel file here<br>
                                <small>or click to browse</small>
                            </p>
                            <input type="file" id="excel-file-input" accept=".xlsx,.xls" style="display: none;">
                        </div>
                        <div id="excel-file-info" class="mt-3" style="display: none;">
                            <p class="mb-1"><strong>File:</strong> <span id="excel-filename"></span></p>
                            <p class="mb-1"><strong>Records:</strong> <span id="excel-records"></span></p>
                            <div id="excel-columns" class="mb-2"></div>
                            
                            <!-- Excel Parsing Configuration -->
                            <div class="card mt-3 mb-3 bg-light">
                                <div class="card-body p-3">
                                    <h6 class="mb-2">Parsing Configuration</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label for="data-start-row" class="form-label">Data starts at row:</label>
                                            <input type="number" id="data-start-row" class="form-control form-control-sm" value="4" min="1" max="20">
                                            <small class="text-muted">Row where actual data begins</small>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="header-rows" class="form-label">Header rows:</label>
                                            <input type="number" id="header-rows" class="form-control form-control-sm" value="2" min="1" max="5">
                                            <small class="text-muted">Number of header rows</small>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check mt-4">
                                                <input class="form-check-input" type="checkbox" id="skip-title-row" checked>
                                                <label class="form-check-label" for="skip-title-row">
                                                    Skip title row
                                                </label>
                                                <small class="d-block text-muted">Skip first row if it's a title</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-sm btn-outline-success" onclick="viewExcelData()">View Sample Data</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Updated TW2 File Upload -->
            <div class="col-lg-4 col-md-12 mb-3">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">Updated TW2 File</h5>
                        <small>Post-Titus Teams Processing</small>
                    </div>
                    <div class="card-body">
                        <div id="updated-tw2-dropzone" class="dropzone">
                            <p class="text-center mb-0">
                                <i class="bi bi-cloud-upload" style="font-size: 2rem;"></i><br>
                                Drag & Drop updated .tw2 file here<br>
                                <small>or click to browse</small>
                            </p>
                            <input type="file" id="updated-tw2-file-input" accept=".tw2,.mdb" style="display: none;">
                        </div>
                        <div class="mt-3">
                            <label for="original-tw2-path" class="form-label">
                                <small>Original File Path (optional - for remote refresh)</small>
                            </label>
                            <div class="input-group input-group-sm">
                                <input type="text" id="original-tw2-path" class="form-control" 
                                       placeholder="e.g., S:\Projects\936290 - UND Flight Operations Building\Data\936290 - UND Flight Operations.tw2"
                                       title="Enter the full path to your original TW2 file for remote refresh capability">
                                <button class="btn btn-outline-secondary" type="button" id="validate-path-btn" onclick="validateTW2Path()">
                                    <i class="bi bi-check-circle"></i> Validate
                                </button>
                            </div>
                            <div id="path-validation-feedback" class="mt-1" style="display: none;"></div>
                        </div>
                        <div id="updated-tw2-file-info" class="mt-3" style="display: none;">
                            <p class="mb-1"><strong>File:</strong> <span id="updated-tw2-filename"></span></p>
                            <p class="mb-1"><strong>Records:</strong> <span id="updated-tw2-records"></span></p>
                            <div id="updated-tw2-columns" class="mb-2"></div>
                            <button class="btn btn-sm btn-outline-warning" onclick="showComparisonView()">
                                <i class="bi bi-bar-chart"></i> Compare Data
                            </button>
                        
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mapping Section -->
        <div id="mapping-section" class="row mb-4" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0">Field Mapping Configuration</h5>
                    </div>
                    <div class="card-body">
                        <p>Map Excel columns to TW2 database fields:</p>
                        <div class="row">
                            <div class="col-md-8">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>TW2 Field (Target)</th>
                                            <th>Excel Column (Source)</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="mapping-table">
                                        <!-- Mapping rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="col-md-4">
                                <div class="alert alert-info">
                                    <h6>Required Fields:</h6>
                                    <ul class="small mb-0">
                                        <li><strong>Tag</strong> - Unit identifier (required for matching)</li>
                                        <li>UnitSize</li>
                                        <li>InletSize</li>
                                        <li>CFMDesign</li>
                                        <li>CFMMinPrime</li>
                                        <li>HeatingPrime</li>
                                        <li>HWCFM</li>
                                        <li>HWGPM</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-warning" id="apply-mapping-btn" onclick="applyMapping()" disabled>
                                Apply Mapping & Update Database
                            </button>
                            <button class="btn btn-secondary" onclick="resetMapping()">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Data Preview Section -->
        <div id="data-preview-section" class="row" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="tw2-tab" data-bs-toggle="tab" href="#tw2-data">TW2 Data</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="excel-tab" data-bs-toggle="tab" href="#excel-data">Excel Data</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="comparison-tab" data-bs-toggle="tab" href="#comparison-data">Performance Comparison</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tw2-data">
                                <div class="table-responsive">
                                    <table id="tw2-table" class="table table-striped table-sm">
                                        <!-- TW2 data will be inserted here -->
                                    </table>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="excel-data">
                                <div class="table-responsive">
                                    <table id="excel-table" class="table table-striped table-sm">
                                        <!-- Excel data will be inserted here -->
                                    </table>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="comparison-data">
                                <!-- Comparison Configuration Panel -->
                                <div class="card mb-4 bg-light">
                                    <div class="card-body">
                                        <h6 class="mb-3">Performance Comparison Configuration</h6>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <label for="mbh-lat-lower-margin" class="form-label">MBH/LAT Lower Margin (%):</label>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">-</span>
                                                    <input type="number" id="mbh-lat-lower-margin" class="form-control" value="15" min="0" max="100" step="0.1">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                                <small class="text-muted">Max underperformance allowed</small>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="mbh-lat-upper-margin" class="form-label">MBH/LAT Upper Margin (%):</label>
                                                <div class="input-group input-group-sm">
                                                    <span class="input-group-text">+</span>
                                                    <input type="number" id="mbh-lat-upper-margin" class="form-control" value="25" min="0" max="100" step="0.1">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                                <small class="text-muted">Max overperformance allowed</small>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="wpd-threshold" class="form-label">WPD Threshold:</label>
                                                <input type="number" id="wpd-threshold" class="form-control form-control-sm" value="5" min="0" max="50" step="0.1">
                                                <small class="text-muted">Alert if over</small>
                                            </div>
                                            <div class="col-md-2">
                                                <label for="apd-threshold" class="form-label">APD Threshold:</label>
                                                <input type="number" id="apd-threshold" class="form-control form-control-sm" value="0.25" min="0" max="5" step="0.01">
                                                <small class="text-muted">Alert if over</small>
                                            </div>
                                            <div class="col-md-2 d-flex align-items-end">
                                                <button class="btn btn-primary w-100" onclick="runPerformanceComparison()" id="compare-btn" disabled>
                                                    <i class="bi bi-bar-chart"></i> Compare
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Comparison Results -->
                                <div id="comparison-results" style="display: none;">
                                    <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap gap-2">
                                        <div class="d-flex align-items-center gap-2" id="comparison-summary" aria-live="polite">
                                            <span class="badge bg-success" id="summary-pass" title="Passing units">Pass: 0</span>
                                            <span class="badge bg-warning text-dark" id="summary-warning" title="Warning units">Warn: 0</span>
                                            <span class="badge bg-danger" id="summary-fail" title="Failing units">Fail: 0</span>
                                            <span class="badge bg-secondary" id="summary-notfound" title="Units not found in TW2">Not Found: 0</span>
                                        </div>
                                        <div class="text-muted small" id="path-source-indicator"></div>
                                    </div>
                                    <div class="table-responsive">
                                        <table id="comparison-table" class="table table-striped table-sm">
                                            <!-- Comparison results will be inserted here -->
                                        </table>
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-primary btn-sm me-2" onclick="refreshAndCompare()" id="refresh-btn">
                                            <i class="bi bi-arrow-clockwise"></i> Refresh & Compare
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="exportComparisonResults()">
                                            <i class="bi bi-download"></i> Export Results
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" style="display: none;">
            <div class="alert alert-success" id="results-content">
                <!-- Results will be displayed here -->
            </div>
        </div>
        
        <!-- Status Messages -->
        <div id="status-messages" class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
            <!-- Toast messages will appear here -->
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Instructions Modal -->
    <div class="modal fade" id="instructionsModal" tabindex="-1" aria-labelledby="instructionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title" id="instructionsModalLabel">
                        <i class="bi bi-question-circle"></i> VAV Data Merger - Complete Workflow Instructions
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                    
                    <!-- Quick Start Section -->
                    <div class="alert alert-success mb-4">
                        <h6 class="alert-heading"><i class="bi bi-lightning-fill"></i> Quick Start</h6>
                        <ol class="mb-0">
                            <li><strong>Start:</strong> Create job in Titus Teams → Set up master VAV → Copy to create all units</li>
                            <li><strong>Export:</strong> Save TW2 file from Teams</li>
                            <li><strong>Upload:</strong> Drag TW2 and Excel files to this tool</li>
                            <li><strong>Apply:</strong> Review mapping → Click "Apply Mapping"</li>
                            <li><strong>Import:</strong> Replace TW2 in Teams → Verify data</li>
                        </ol>
                    </div>

                    <!-- Tabbed Content -->
                    <ul class="nav nav-tabs mb-3" id="instructionTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="teams-tab" data-bs-toggle="tab" data-bs-target="#teams" type="button" role="tab">Titus Teams</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="excel-setup-tab" data-bs-toggle="tab" data-bs-target="#excel-setup" type="button" role="tab">Excel Setup</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="tool-usage-tab" data-bs-toggle="tab" data-bs-target="#tool-usage" type="button" role="tab">Tool Usage</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="troubleshooting-tab" data-bs-toggle="tab" data-bs-target="#troubleshooting" type="button" role="tab">Troubleshooting</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="instructionTabContent">
                        
                        <!-- Titus Teams Tab -->
                        <div class="tab-pane fade show active" id="teams" role="tabpanel">
                            <h6><i class="bi bi-gear-fill text-primary"></i> Part 1: Titus Teams Preparation</h6>
                            
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 1: Create New Job</strong>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>Open Titus Teams software</li>
                                        <li>Create new job/project (e.g., "936290 - UND Flight Operations")</li>
                                        <li>Set up project parameters and building/zone information</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 2: Create Master VAV Unit</strong>
                                </div>
                                <div class="card-body">
                                    <p>Create first VAV unit with complete specifications:</p>
                                    <ul>
                                        <li><strong>Tag:</strong> V-1-01 <small class="text-muted">(zero-padded format)</small></li>
                                        <li><strong>Unit Size:</strong> VAV box size (6", 8", 10", 14")</li>
                                        <li><strong>Inlet Size:</strong> Air inlet diameter</li>
                                        <li><strong>CFM Design:</strong> Maximum design airflow</li>
                                        <li><strong>CFM Min Prime:</strong> Minimum primary airflow</li>
                                        <li><strong>Heating Prime:</strong> Primary airflow during heating</li>
                                        <li><strong>HWCFM:</strong> Hot water coil airflow</li>
                                        <li><strong>HWGPM:</strong> Hot water flow rate</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 3: Copy Units</strong>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>Select completed VAV unit</li>
                                        <li>Use Teams' copy/duplicate function</li>
                                        <li>Create required quantity (e.g., 42 units)</li>
                                        <li>Tags: V-1-01, V-1-02, V-1-03, etc. <small class="text-muted">(sequential format)</small></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header bg-light">
                                    <strong>Step 4: Export TW2 Database</strong>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>Save Titus Teams project</li>
                                        <li>Locate .tw2 file in project folder</li>
                                        <li>Copy to known location for this tool</li>
                                        <li><span class="badge bg-warning text-dark">Important:</span> Keep .tw2 extension</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Excel Setup Tab -->
                        <div class="tab-pane fade" id="excel-setup" role="tabpanel">
                            <h6><i class="bi bi-file-earmark-excel text-success"></i> Part 2: Excel Data Preparation</h6>
                            
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Required Excel Columns</strong>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Column Name</th>
                                                    <th>Description</th>
                                                    <th>Example Values</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><code>Unit_No</code></td>
                                                    <td>Unit identifier</td>
                                                    <td>V-1-1, V-1-2, V-1-3</td>
                                                </tr>
                                                <tr>
                                                    <td><code>Unit_Size</code></td>
                                                    <td>VAV box size</td>
                                                    <td>6, 8, 10, 14, 24x16</td>
                                                </tr>
                                                <tr>
                                                    <td><code>Inlet_Size</code></td>
                                                    <td>Inlet size in inches</td>
                                                    <td>6", 8", 10", 14"</td>
                                                </tr>
                                                <tr>
                                                    <td><code>CFM_Max</code></td>
                                                    <td>Maximum design airflow</td>
                                                    <td>500, 750, 1200</td>
                                                </tr>
                                                <tr>
                                                    <td><code>CFM_Min</code></td>
                                                    <td>Minimum airflow</td>
                                                    <td>100, 150, 250</td>
                                                </tr>
                                                <tr>
                                                    <td><code>CFM_Heat</code></td>
                                                    <td>Heating mode airflow</td>
                                                    <td>300, 450, 600</td>
                                                </tr>
                                                <tr>
                                                    <td><code>GPM</code></td>
                                                    <td>Hot water flow rate</td>
                                                    <td>2.5, 3.0, 4.5</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Format Requirements</strong>
                                </div>
                                <div class="card-body">
                                    <ul>
                                        <li>Data starts in <strong>row 3</strong> (rows 1-2 can be headers)</li>
                                        <li>Remove blank rows</li>
                                        <li>Save as .xlsx format</li>
                                        <li>Tag formats: V-1-1 → automatically converts to V-1-01</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Tool Usage Tab -->
                        <div class="tab-pane fade" id="tool-usage" role="tabpanel">
                            <h6><i class="bi bi-tools text-warning"></i> Part 3: Using VAV Data Merger</h6>
                            
                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 1: Upload Files</strong>
                                </div>
                                <div class="card-body">
                                    <ol>
                                        <li>Drag TW2 file to left dropzone</li>
                                        <li>Drag Excel file to right dropzone</li>
                                        <li>Wait for green success messages</li>
                                        <li>Review data preview tables</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 2: Field Mapping</strong>
                                </div>
                                <div class="card-body">
                                    <p>Automatic mapping between TW2 and Excel fields:</p>
                                    <ul>
                                        <li><strong>Tag</strong> ← Unit_No <small class="text-muted">(identifier matching)</small></li>
                                        <li><strong>UnitSize</strong> ← Unit_Size</li>
                                        <li><strong>InletSize</strong> ← Inlet_Size</li>
                                        <li><strong>CFMDesign</strong> ← CFM_Max</li>
                                        <li><strong>CFMMinPrime</strong> ← CFM_Min</li>
                                        <li><strong>HWCFM</strong> ← CFM_Heat</li>
                                        <li><strong>HWGPM</strong> ← GPM</li>
                                    </ul>
                                    <p class="mb-0"><i class="bi bi-lightbulb"></i> <small>Hover over TW2 field names for detailed descriptions</small></p>
                                </div>
                            </div>

                            <div class="card mb-3">
                                <div class="card-header bg-light">
                                    <strong>Step 3: Apply Mapping</strong>
                                </div>
                                <div class="card-body">
                                    <ol>
                                        <li>Review mapping table</li>
                                        <li>Click "Apply Mapping & Update Database"</li>
                                        <li>Monitor progress (processed in batches)</li>
                                        <li>Wait for success confirmation</li>
                                    </ol>
                                    <div class="alert alert-info mt-2">
                                        <small><i class="bi bi-info-circle"></i> Backup file automatically created with timestamp</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Troubleshooting Tab -->
                        <div class="tab-pane fade" id="troubleshooting" role="tabpanel">
                            <h6><i class="bi bi-exclamation-triangle text-danger"></i> Troubleshooting Guide</h6>
                            
                            <div class="accordion" id="troubleshootingAccordion">
                                
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                            "No records updated" Error
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                        <div class="accordion-body">
                                            <strong>Causes:</strong>
                                            <ul>
                                                <li>Tag format mismatch between Excel and TW2</li>
                                                <li>Excel data in wrong rows</li>
                                            </ul>
                                            <strong>Solutions:</strong>
                                            <ul>
                                                <li>Ensure Excel Unit_No matches TW2 Tag format</li>
                                                <li>Data should start in row 3 of Excel</li>
                                                <li>Check for blank rows in Excel data</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingTwo">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                            "Upload error: SyntaxError" 
                                        </button>
                                    </h2>
                                    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                        <div class="accordion-body">
                                            <strong>Cause:</strong> NaN/empty values in Excel data
                                            <br>
                                            <strong>Solution:</strong> Clean Excel file - ensure numeric columns contain valid numbers, remove empty cells
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingThree">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                            "Too few parameters" SQL Error
                                        </button>
                                    </h2>
                                    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                        <div class="accordion-body">
                                            <strong>Status:</strong> Known issue with some field batches - partial updates still successful
                                            <br>
                                            <strong>Impact:</strong> Core fields (Tag, UnitSize, InletSize, CFMDesign, HWGPM) update successfully
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingFour">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                            Missing Dependencies
                                        </button>
                                    </h2>
                                    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#troubleshootingAccordion">
                                        <div class="accordion-body">
                                            Run in command prompt:
                                            <pre class="bg-dark text-light p-2 mt-2"><code>pip install flask flask-cors pandas pyodbc</code></pre>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <div class="card mt-4">
                                <div class="card-header bg-light">
                                    <strong>Post-Processing: Import Back to Titus Teams</strong>
                                </div>
                                <div class="card-body">
                                    <ol>
                                        <li>Close Titus Teams completely</li>
                                        <li>Replace original TW2 file with updated version</li>
                                        <li>Reopen Teams and verify data populated correctly</li>
                                        <li>Run Teams validation checks</li>
                                        <li>Archive backup files for future reference</li>
                                    </ol>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="/static/VAV_Data_Merger_Instructions.md" target="_blank" class="btn btn-primary">
                        <i class="bi bi-download"></i> Download Full Guide
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/app.js"></script>
</body>
</html>
